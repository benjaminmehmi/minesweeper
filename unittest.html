<!DOCTYPE html>
<html lang="no">

<head>
    <meta charset="utf-8" />
    <title>QUnit – Minesweeper tests</title>
    <link rel="stylesheet" href="https://unpkg.com/qunit@2.20.0/qunit/qunit.css">
</head>

<body>
    <div id="qunit"></div>
    <div id="qunit-fixture"></div>

    <!-- Last inn koden din før testene (endre sti/filnavn ved behov) -->
    <script src="controller.js"></script>

    <script>
        // 3x3 Model
        const miniModel = {
            app: {
                mines: new Set([0,4]), // Bombs at indices 0 and 4
                minesCount: 2,
                flagModeEnabled: false,
                gameOver: 'ongoing',
                board: Array(9).fill(null).map((_, index) => ({
                    tileIndex: index,
                    isOpened: false,
                    isMine: [0,4].includes(index),
                    isFlagged: false,
                    neighbourCount: 0
                }))
            }
        };

        window.model = miniModel;

    </script>

    <script src="https://unpkg.com/qunit@2.20.0/qunit/qunit.js"></script>
    <script>
        // dummy view
        function updateView() { }

        function resetBoard() {
            model.app.board.forEach(tile => {
                tile.isOpened = false;
                tile.isFlagged = false;
            });
            model.app.gameOver = 'ongoing';
            model.app.flagModeEnabled = false;
        }

        QUnit.module('countNeighbours(index)', function () {
            QUnit.test('Hjørne øverst-venstre', function (assert) {
                assert.equal(countNeighbours(0), 1, 'Index 0 har 1 nabo-bombe');
            });
            QUnit.test('Kanter og midten', function (assert) {
                assert.equal(countNeighbours(1), 2, 'Index 1 har 2 nabo-bomber');
                assert.equal(countNeighbours(2), 1, 'Index 2 har 1 nabo-bombe');
                assert.equal(countNeighbours(3), 2, 'Index 3 har 2 nabo-bomber');
                assert.equal(countNeighbours(4), 1, 'Index 4 (midten) har 1 nabo-bombe');
            });
            QUnit.test('Hjørne nederst-høyre', function (assert) {
                assert.equal(countNeighbours(8), 1, 'Index 8 har 1 nabo-bombe');
            });
        });

        QUnit.module('openCell(index)', function () {
            QUnit.test('Åpne trygg celle', function (assert) {
                resetBoard();
                openCell(2);
                assert.equal(model.app.board[2].isOpened, true, 'Cell 2 should be opened');
                assert.equal(model.app.gameOver, 'ongoing', 'Game should continue');
            });

            QUnit.test('Spill over når bombe åpnes', function (assert) {
                resetBoard();
                openCell(0);
                assert.equal(model.app.gameOver, 'lost', 'Game should be lost when mine is opened');
                assert.equal(model.app.board[0].isOpened, true, 'Mine cell should be opened');
            });
        });

        QUnit.module('restartGame()', function () {
            QUnit.test('Resets all tiles to closed', function (assert) {
                model.app.board[0].isOpened = true;
                model.app.board[1].isOpened = true;
                model.app.board[2].isOpened = true;

                restartGame();

                model.app.board.forEach(tile => {
                    assert.equal(tile.isOpened, false, `Tile ${tile.tileIndex} should be closed`);
                });
            });
        });
    </script>
</body>

</html>
